<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Опросник</title>
    <script defer>
        document.addEventListener("DOMContentLoaded", () => {
            // Скрываем вопросы с is_conditional = 1
            document.querySelectorAll(".question[data-conditional='true']").forEach(q => {
                q.style.display = "none";
            });

            // Обработчик выбора вариантов ответа
            document.querySelectorAll("input[type=radio], input[type=checkbox]").forEach(input => {
                input.addEventListener("change", function() {
                    let nextQuestion = this.dataset.next;
                    if (nextQuestion) {
                        let questionDiv = document.querySelector(`[data-id="${nextQuestion}"]`);
                        if (questionDiv) questionDiv.style.display = "block";
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>Пройдите опрос</h1>
    <form id="survey-form" action="/submit" method="post">
        {% for question in questions %}
            <div class="question" data-id="{{ question.id }}" data-conditional="{{ 'true' if question.is_conditional else 'false' }}">
                <p>{{ question.text }}</p>
                {% if question.type == "single" %}
                    {% for option in question.options %}
                        <label>
                            <input type="radio" name="{{ question.id }}_{{ option.id }}" 
                                   value="{{ option.risk_type }},{{ option.risk_value }}"
                                   data-next="{{ option.next_question or '' }}">
                            {{ option.text }}
                        </label><br>
                    {% endfor %}
                {% elif question.type == "multiple" %}
                    {% for option in question.options %}
                        <label>
                            <input type="checkbox" name="{{ question.id }}_{{ option.id }}" 
                                   value="{{ option.risk_type }},{{ option.risk_value }}"
                                   data-next="{{ option.next_question or '' }}">
                            {{ option.text }}
                        </label><br>
                    {% endfor %}
                {% endif %}
            </div>
        {% endfor %}
        <button type="submit">Отправить</button>
    </form>
</body>
</html>
